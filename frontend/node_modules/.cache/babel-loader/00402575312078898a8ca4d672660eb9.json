{"ast":null,"code":"var _jsxFileName = \"/home/filip/Desktop/facial-animation/frontend/src/components/View.js\";\nimport React, { Component } from \"react\";\nimport \"./View.css\";\nimport Model from \"./Model.js\";\nimport axios from \"axios\";\nimport AudioRecorder from \"./AudioRecorder.js\";\nimport \"./Slider.css\";\nimport { Transition } from \"react-transition-group\";\nimport { login, authFetch, useAuth, logout } from \"../auth\";\nconst AUDIO_FRAME = 10;\nconst FPS = 60;\nconst defaultStyle = {\n  transition: `opacity ${300}ms ease-in-out`,\n  opacity: 0\n};\nconst transitionStyles = {\n  entering: {\n    opacity: 1\n  },\n  entered: {\n    opacity: 1\n  },\n  exiting: {\n    opacity: 0\n  },\n  exited: {\n    opacity: 0\n  }\n};\n\nclass View extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      file: undefined,\n      animationStatus: \"STOP\",\n      visemes: undefined,\n      inputProcessed: false,\n      sliderValue: 0.4,\n      popup: false,\n      popupText: \"\"\n    };\n    this.move = 0.02;\n    this.delta = 0;\n    this.modelControlActive = false;\n    this.currentFrame = 0;\n    this.lidMove = 0.1;\n    this.lidSpeed = 0.1;\n    this.lidWait = 1;\n    this.play = this.play.bind(this);\n    this.pause = this.pause.bind(this);\n    this.stop = this.stop.bind(this);\n    this.processResponse = this.processResponse.bind(this);\n    this.fetchInput = this.fetchInput.bind(this);\n    this.playAnimation = this.playAnimation.bind(this);\n    this.pauseAnimation = this.pauseAnimation.bind(this);\n    this.stopAnimation = this.stopAnimation.bind(this);\n    this.handleFile = this.handleFile.bind(this);\n    this.sendFile = this.sendFile.bind(this);\n    this.handleSlider = this.handleSlider.bind(this);\n    this.handleRecording = this.handleRecording.bind(this);\n    this.openPopup = this.openPopup.bind(this);\n    this.closePopup = this.closePopup.bind(this);\n  }\n\n  componentDidMount() {\n    this.fetchInput();\n    this.audio = new Audio();\n    this.audio.loop = true;\n    this.setState({\n      mounted: true\n    });\n  }\n\n  componentDidUpdate() {}\n\n  fetchInput() {\n    fetch(\"/api/time\").then(res => res.json()).then(data => {\n      console.log(data);\n    });\n  }\n\n  calculateDistance(point1, point2) {\n    return Math.sqrt(Math.pow(point1[0] - point2[0], 2) + Math.pow(point1[1] - point2[1], 2));\n  }\n\n  processResponse(response) {\n    const step = 1000 / AUDIO_FRAME / FPS;\n    var result = [],\n        frame = undefined,\n        j = undefined;\n\n    for (var i = 0; i < response.length; i += step) {\n      // change the frequency of the visemes from 100Hz to 60Hz\n      frame = response.slice(i, i + step)[0];\n      result.push(frame);\n      j = result.length - 1;\n\n      if (j >= 3) {\n        // eliminate singular visemes\n        if (result[j - 2] !== result[j - 1] && result[j - 1] !== result[j]) {\n          result[result.length - 2] = result[result.length - 3];\n        }\n      }\n\n      if (j >= 4) {\n        // eliminate double visemes\n        if (result[j] !== result[j - 1]) {\n          if (!(result[j - 1] === result[j - 2] && result[j - 2] === result[j - 3])) {\n            result[j - 1] = result[j];\n            result[j - 2] = result[j - 3];\n          }\n        }\n      }\n    }\n\n    this.setState({\n      visemes: result,\n      inputProcessed: true\n    });\n  }\n\n  maxElement(array) {\n    if (array.length === 0) return null;\n    var modeMap = {};\n    var maxEl = array[0],\n        maxCount = 1;\n\n    for (var i = 0; i < array.length; i++) {\n      var el = array[i];\n      if (modeMap[el] == null) modeMap[el] = 1;else modeMap[el]++;\n\n      if (modeMap[el] > maxCount) {\n        maxEl = el;\n        maxCount = modeMap[el];\n      }\n    }\n\n    return maxEl;\n  }\n\n  stop() {\n    if (this.state.animationStatus === \"PLAY\" || this.state.animationStatus === \"PAUSE\") {\n      this.audio.pause();\n      this.audio.currentTime = 0;\n      this.setState({\n        animationStatus: \"STOP\"\n      });\n    }\n  }\n\n  play() {\n    if (this.state.animationStatus === \"STOP\" || this.state.animationStatus === \"PAUSE\") {\n      this.audio.play();\n      this.setState({\n        animationStatus: \"PLAY\"\n      });\n    }\n  }\n\n  pause() {\n    if (this.state.animationStatus === \"PLAY\") {\n      this.audio.pause();\n      this.setState({\n        animationStatus: \"PAUSE\"\n      });\n    }\n  }\n\n  playAnimation() {\n    if (!this.state.inputProcessed) {\n      this.openPopup(\"Upload the audio file to the server!\");\n    } else {\n      this.play();\n    }\n  }\n\n  stopAnimation() {\n    if (!this.state.inputProcessed) {\n      this.openPopup(\"Upload the audio file to the server!\");\n    } else {\n      this.stop();\n    }\n  }\n\n  pauseAnimation() {\n    if (!this.state.inputProcessed) {\n      this.openPopup(\"Upload the audio file to the server!\");\n    } else {\n      this.pause();\n    }\n  }\n\n  handleFile(event) {\n    console.log(event.target.files);\n\n    if (event.target.files.length > 0) {\n      var fileData = event.target.files[0];\n      var fileSource = URL.createObjectURL(fileData);\n      this.stop();\n      this.setState({\n        file: fileData,\n        inputProcessed: false,\n        filename: fileData.name\n      });\n      this.audio.src = fileSource;\n    }\n  }\n\n  handleRecording(recording) {\n    this.stop();\n    this.setState({\n      file: recording,\n      inputProcessed: false,\n      filename: \"Recording\"\n    });\n    this.audio.src = URL.createObjectURL(recording);\n    console.log(this.state.file, this.audio.src);\n  }\n\n  async sendFile() {\n    if (this.state.file) {\n      const data = new FormData();\n      data.append(\"file\", this.state.file);\n      this.setState({\n        inputProcessed: undefined\n      });\n      this.stop();\n      authFetch(\"/api/upload\", {\n        method: \"POST\",\n        body: data\n      }).then(res => {\n        console.log(res);\n\n        if (res.status === 401) {\n          this.setState({\n            inputProcessed: false\n          });\n          this.openPopup(\"Sorry you aren't authorized!\");\n          return null;\n        } else if (res.status !== 200) {\n          this.setState({\n            inputProcessed: false\n          });\n          this.openPopup(\"Server failure!\");\n          return null;\n        }\n\n        return res.json();\n      }).then(res => {\n        console.log(res);\n\n        if (res) {\n          if (res.status === 200) {\n            this.processResponse(res.result);\n          } else if (res.message === \"Extension\") {\n            this.setState({\n              inputProcessed: false\n            });\n            this.openPopup(\"Incorrect extension! Upload .wav and .mp3 files.\");\n          } else if (res.message === \"Model\") {\n            this.setState({\n              inputProcessed: false\n            });\n            this.openPopup(\"Model failure!\");\n          }\n        }\n      });\n    } else {\n      this.openPopup(\"Choose a file!\");\n    }\n  }\n\n  handleSlider(event) {\n    this.setState({\n      sliderValue: event.target.value\n    });\n  }\n\n  openPopup(text) {\n    this.setState({\n      popup: true,\n      popupText: text\n    });\n  }\n\n  closePopup() {\n    this.setState({\n      popup: false,\n      popupText: \"\"\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: \"view-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Transition, {\n      in: this.state.popup,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 9\n      }\n    }, state => /*#__PURE__*/React.createElement(\"div\", {\n      style: { ...defaultStyle,\n        ...transitionStyles[state]\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 292,\n        columnNumber: 13\n      }\n    }, this.state.popup && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"background\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"popup\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"popup-text\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 301,\n        columnNumber: 21\n      }\n    }, this.state.popupText), /*#__PURE__*/React.createElement(\"button\", {\n      id: \"popup-close\",\n      onClick: this.closePopup,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 302,\n        columnNumber: 21\n      }\n    }, \"X\"))))), /*#__PURE__*/React.createElement(Transition, {\n      in: this.state.inputProcessed === undefined,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 311,\n        columnNumber: 9\n      }\n    }, state => /*#__PURE__*/React.createElement(\"div\", {\n      style: { ...defaultStyle,\n        ...transitionStyles[state]\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 313,\n        columnNumber: 13\n      }\n    }, this.state.inputProcessed === undefined && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"background\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"loader\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 321,\n        columnNumber: 19\n      }\n    })))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"top vertical\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 327,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(AudioRecorder, {\n      newRecording: this.handleRecording,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 328,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"label\", {\n      className: \"styled-button horizontal\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 329,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 330,\n        columnNumber: 13\n      }\n    }, \"Choose file\"), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"chosen-file\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 331,\n        columnNumber: 13\n      }\n    }, this.state.filename), /*#__PURE__*/React.createElement(\"input\", {\n      id: \"choose-file\",\n      type: \"file\",\n      accept: \"audio/wav, audio/mp3\",\n      onChange: this.handleFile,\n      multiple: false,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 332,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(\"button\", {\n      id: \"upload-button\",\n      className: \"styled-button narrow\",\n      onClick: this.sendFile,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 340,\n        columnNumber: 11\n      }\n    }, \"Upload\")), /*#__PURE__*/React.createElement(Model, {\n      id: \"model\",\n      animationStatus: this.state.animationStatus,\n      visemes: this.state.visemes,\n      sliderValue: this.state.sliderValue,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 348,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"bottom horizontal\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 354,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      id: \"play\",\n      className: \"player styled-button\",\n      onClick: this.playAnimation,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 355,\n        columnNumber: 11\n      }\n    }, \"Play\"), /*#__PURE__*/React.createElement(\"button\", {\n      id: \"pause\",\n      className: \"player styled-button\",\n      onClick: this.pauseAnimation,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 362,\n        columnNumber: 11\n      }\n    }, \"Pause\"), /*#__PURE__*/React.createElement(\"button\", {\n      id: \"stop\",\n      className: \"player styled-button\",\n      onClick: this.stopAnimation,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 369,\n        columnNumber: 11\n      }\n    }, \"Stop\"), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"spacer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 376,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"slider-container\",\n      className: \"player\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 377,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"range\",\n      id: \"slider\",\n      min: 0.1,\n      max: 1,\n      value: this.state.sliderValue,\n      step: 0.05,\n      onChange: this.handleSlider,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 378,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 13\n      }\n    }, this.state.sliderValue))));\n  }\n\n}\n\nexport default View;","map":{"version":3,"sources":["/home/filip/Desktop/facial-animation/frontend/src/components/View.js"],"names":["React","Component","Model","axios","AudioRecorder","Transition","login","authFetch","useAuth","logout","AUDIO_FRAME","FPS","defaultStyle","transition","opacity","transitionStyles","entering","entered","exiting","exited","View","constructor","props","state","file","undefined","animationStatus","visemes","inputProcessed","sliderValue","popup","popupText","move","delta","modelControlActive","currentFrame","lidMove","lidSpeed","lidWait","play","bind","pause","stop","processResponse","fetchInput","playAnimation","pauseAnimation","stopAnimation","handleFile","sendFile","handleSlider","handleRecording","openPopup","closePopup","componentDidMount","audio","Audio","loop","setState","mounted","componentDidUpdate","fetch","then","res","json","data","console","log","calculateDistance","point1","point2","Math","sqrt","pow","response","step","result","frame","j","i","length","slice","push","maxElement","array","modeMap","maxEl","maxCount","el","currentTime","event","target","files","fileData","fileSource","URL","createObjectURL","filename","name","src","recording","FormData","append","method","body","status","message","value","text","render"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport \"./View.css\";\nimport Model from \"./Model.js\";\nimport axios from \"axios\";\nimport AudioRecorder from \"./AudioRecorder.js\";\nimport \"./Slider.css\";\nimport { Transition } from \"react-transition-group\";\nimport { login, authFetch, useAuth, logout } from \"../auth\";\n\nconst AUDIO_FRAME = 10;\nconst FPS = 60;\n\nconst defaultStyle = {\n  transition: `opacity ${300}ms ease-in-out`,\n  opacity: 0,\n};\n\nconst transitionStyles = {\n  entering: { opacity: 1 },\n  entered: { opacity: 1 },\n  exiting: { opacity: 0 },\n  exited: { opacity: 0 },\n};\n\nclass View extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      file: undefined,\n      animationStatus: \"STOP\",\n      visemes: undefined,\n      inputProcessed: false,\n      sliderValue: 0.4,\n      popup: false,\n      popupText: \"\",\n    };\n\n    this.move = 0.02;\n    this.delta = 0;\n\n    this.modelControlActive = false;\n\n    this.currentFrame = 0;\n\n    this.lidMove = 0.1;\n    this.lidSpeed = 0.1;\n    this.lidWait = 1;\n\n    this.play = this.play.bind(this);\n    this.pause = this.pause.bind(this);\n    this.stop = this.stop.bind(this);\n    this.processResponse = this.processResponse.bind(this);\n    this.fetchInput = this.fetchInput.bind(this);\n    this.playAnimation = this.playAnimation.bind(this);\n    this.pauseAnimation = this.pauseAnimation.bind(this);\n    this.stopAnimation = this.stopAnimation.bind(this);\n    this.handleFile = this.handleFile.bind(this);\n    this.sendFile = this.sendFile.bind(this);\n    this.handleSlider = this.handleSlider.bind(this);\n    this.handleRecording = this.handleRecording.bind(this);\n    this.openPopup = this.openPopup.bind(this);\n    this.closePopup = this.closePopup.bind(this);\n  }\n\n  componentDidMount() {\n    this.fetchInput();\n\n    this.audio = new Audio();\n    this.audio.loop = true;\n    this.setState({\n      mounted: true,\n    });\n  }\n\n  componentDidUpdate() {}\n\n  fetchInput() {\n    fetch(\"/api/time\")\n      .then((res) => res.json())\n      .then((data) => {\n        console.log(data);\n      });\n  }\n\n  calculateDistance(point1, point2) {\n    return Math.sqrt(\n      Math.pow(point1[0] - point2[0], 2) + Math.pow(point1[1] - point2[1], 2)\n    );\n  }\n\n  processResponse(response) {\n    const step = 1000 / AUDIO_FRAME / FPS;\n    var result = [],\n      frame = undefined,\n      j = undefined;\n    for (var i = 0; i < response.length; i += step) {\n      // change the frequency of the visemes from 100Hz to 60Hz\n      frame = response.slice(i, i + step)[0];\n      result.push(frame);\n      j = result.length - 1;\n      if (j >= 3) {\n        // eliminate singular visemes\n        if (result[j - 2] !== result[j - 1] && result[j - 1] !== result[j]) {\n          result[result.length - 2] = result[result.length - 3];\n        }\n      }\n      if (j >= 4) {\n        // eliminate double visemes\n        if (result[j] !== result[j - 1]) {\n          if (\n            !(\n              result[j - 1] === result[j - 2] && result[j - 2] === result[j - 3]\n            )\n          ) {\n            result[j - 1] = result[j];\n            result[j - 2] = result[j - 3];\n          }\n        }\n      }\n    }\n    this.setState({\n      visemes: result,\n      inputProcessed: true,\n    });\n  }\n\n  maxElement(array) {\n    if (array.length === 0) return null;\n    var modeMap = {};\n    var maxEl = array[0],\n      maxCount = 1;\n    for (var i = 0; i < array.length; i++) {\n      var el = array[i];\n      if (modeMap[el] == null) modeMap[el] = 1;\n      else modeMap[el]++;\n      if (modeMap[el] > maxCount) {\n        maxEl = el;\n        maxCount = modeMap[el];\n      }\n    }\n    return maxEl;\n  }\n\n  stop() {\n    if (\n      this.state.animationStatus === \"PLAY\" ||\n      this.state.animationStatus === \"PAUSE\"\n    ) {\n      this.audio.pause();\n      this.audio.currentTime = 0;\n      this.setState({ animationStatus: \"STOP\" });\n    }\n  }\n\n  play() {\n    if (\n      this.state.animationStatus === \"STOP\" ||\n      this.state.animationStatus === \"PAUSE\"\n    ) {\n      this.audio.play();\n      this.setState({ animationStatus: \"PLAY\" });\n    }\n  }\n\n  pause() {\n    if (this.state.animationStatus === \"PLAY\") {\n      this.audio.pause();\n      this.setState({ animationStatus: \"PAUSE\" });\n    }\n  }\n\n  playAnimation() {\n    if (!this.state.inputProcessed) {\n      this.openPopup(\"Upload the audio file to the server!\");\n    } else {\n      this.play();\n    }\n  }\n\n  stopAnimation() {\n    if (!this.state.inputProcessed) {\n      this.openPopup(\"Upload the audio file to the server!\");\n    } else {\n      this.stop();\n    }\n  }\n\n  pauseAnimation() {\n    if (!this.state.inputProcessed) {\n      this.openPopup(\"Upload the audio file to the server!\");\n    } else {\n      this.pause();\n    }\n  }\n\n  handleFile(event) {\n    console.log(event.target.files);\n    if (event.target.files.length > 0) {\n      var fileData = event.target.files[0];\n      var fileSource = URL.createObjectURL(fileData);\n\n      this.stop();\n      this.setState({\n        file: fileData,\n        inputProcessed: false,\n        filename: fileData.name,\n      });\n      this.audio.src = fileSource;\n    }\n  }\n\n  handleRecording(recording) {\n    this.stop();\n    this.setState({\n      file: recording,\n      inputProcessed: false,\n      filename: \"Recording\",\n    });\n    this.audio.src = URL.createObjectURL(recording);\n\n    console.log(this.state.file, this.audio.src);\n  }\n\n  async sendFile() {\n    if (this.state.file) {\n      const data = new FormData();\n      data.append(\"file\", this.state.file);\n\n      this.setState({ inputProcessed: undefined });\n      this.stop();\n\n      authFetch(\"/api/upload\", { method: \"POST\", body: data })\n        .then((res) => {\n          console.log(res);\n          if (res.status === 401) {\n            this.setState({ inputProcessed: false });\n            this.openPopup(\"Sorry you aren't authorized!\");\n            return null;\n          } else if (res.status !== 200) {\n            this.setState({ inputProcessed: false });\n            this.openPopup(\"Server failure!\");\n            return null;\n          }\n          return res.json();\n        })\n        .then((res) => {\n          console.log(res);\n          if (res) {\n            if (res.status === 200) {\n              this.processResponse(res.result);\n            } else if (res.message === \"Extension\") {\n              this.setState({ inputProcessed: false });\n              this.openPopup(\n                \"Incorrect extension! Upload .wav and .mp3 files.\"\n              );\n            } else if (res.message === \"Model\") {\n              this.setState({ inputProcessed: false });\n              this.openPopup(\"Model failure!\");\n            }\n          }\n        });\n    } else {\n      this.openPopup(\"Choose a file!\");\n    }\n  }\n\n  handleSlider(event) {\n    this.setState({\n      sliderValue: event.target.value,\n    });\n  }\n\n  openPopup(text) {\n    this.setState({\n      popup: true,\n      popupText: text,\n    });\n  }\n\n  closePopup() {\n    this.setState({\n      popup: false,\n      popupText: \"\",\n    });\n  }\n\n  render() {\n    return (\n      <div id=\"view-container\">\n        <Transition in={this.state.popup}>\n          {(state) => (\n            <div\n              style={{\n                ...defaultStyle,\n                ...transitionStyles[state],\n              }}\n            >\n              {this.state.popup && (\n                <div className=\"background\">\n                  <div className=\"popup\">\n                    <div id=\"popup-text\">{this.state.popupText}</div>\n                    <button id=\"popup-close\" onClick={this.closePopup}>\n                      X\n                    </button>\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n        </Transition>\n        <Transition in={this.state.inputProcessed === undefined}>\n          {(state) => (\n            <div\n              style={{\n                ...defaultStyle,\n                ...transitionStyles[state],\n              }}\n            >\n              {this.state.inputProcessed === undefined && (\n                <div className=\"background\">\n                  <div className=\"loader\"></div>\n                </div>\n              )}\n            </div>\n          )}\n        </Transition>\n        <div className=\"top vertical\">\n          <AudioRecorder newRecording={this.handleRecording} />\n          <label className=\"styled-button horizontal\">\n            <div>Choose file</div>\n            <div id=\"chosen-file\">{this.state.filename}</div>\n            <input\n              id=\"choose-file\"\n              type=\"file\"\n              accept=\"audio/wav, audio/mp3\"\n              onChange={this.handleFile}\n              multiple={false}\n            />\n          </label>\n          <button\n            id=\"upload-button\"\n            className=\"styled-button narrow\"\n            onClick={this.sendFile}\n          >\n            Upload\n          </button>\n        </div>\n        <Model\n          id=\"model\"\n          animationStatus={this.state.animationStatus}\n          visemes={this.state.visemes}\n          sliderValue={this.state.sliderValue}\n        />\n        <div className=\"bottom horizontal\">\n          <button\n            id=\"play\"\n            className=\"player styled-button\"\n            onClick={this.playAnimation}\n          >\n            Play\n          </button>\n          <button\n            id=\"pause\"\n            className=\"player styled-button\"\n            onClick={this.pauseAnimation}\n          >\n            Pause\n          </button>\n          <button\n            id=\"stop\"\n            className=\"player styled-button\"\n            onClick={this.stopAnimation}\n          >\n            Stop\n          </button>\n          <span className=\"spacer\" />\n          <div id=\"slider-container\" className=\"player\">\n            <input\n              type=\"range\"\n              id=\"slider\"\n              min={0.1}\n              max={1}\n              value={this.state.sliderValue}\n              step={0.05}\n              onChange={this.handleSlider}\n            />\n            <div>{this.state.sliderValue}</div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default View;\n"]},"metadata":{},"sourceType":"module"}