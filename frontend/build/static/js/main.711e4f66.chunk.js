(this.webpackJsonpweb2=this.webpackJsonpweb2||[]).push([[0],{53:function(e,t,n){e.exports=n(89)},58:function(e,t,n){},59:function(e,t,n){},61:function(e,t,n){},81:function(e,t,n){},82:function(e,t,n){},89:function(e,t,n){"use strict";n.r(t);var a=n(1),i=n.n(a),o=n(21),s=n.n(o),r=(n(58),n(26)),l=n(50),c=n(10),d=(n(59),n(24)),u=n(22),h=n.n(u),m=n(25),p=n(2),v=n(5),f=n(7),b=n(4),y=n(3),w=(n(61),n(44)),S=n(52),g=n(0),k=n(45),E=n(46),O=n(47),j=function(e){Object(b.a)(n,e);var t=Object(y.a)(n);function n(e){var a;return Object(p.a)(this,n),(a=t.call(this,e)).state={animationStatus:a.props.animationStatus,intensity:a.props.sliderValue},a.visemes=void 0,a.visemesNames=void 0,a.move=.02,a.delta=0,a.modelControlActive=!1,a.currentFrame=1,a.lidMove=.1,a.lidSpeed=.1,a.lidWait=1,a.exponent=6,a.obamaRatio=[.8,.8],a.start=a.start.bind(Object(f.a)(a)),a.animate=a.animate.bind(Object(f.a)(a)),a.onWindowResize=a.onWindowResize.bind(Object(f.a)(a)),a.addCube=a.addCube.bind(Object(f.a)(a)),a.addModel=a.addModel.bind(Object(f.a)(a)),a.getMouthControl=a.getModelControl.bind(Object(f.a)(a)),a.moveLid=a.moveLid.bind(Object(f.a)(a)),a.nextViseme=a.nextViseme.bind(Object(f.a)(a)),a.resetModel=a.resetModel.bind(Object(f.a)(a)),a}return Object(v.a)(n,[{key:"componentDidMount",value:function(){var e=window.innerWidth,t=window.innerHeight;this.scene=new g.fb,this.camera=new g.W(75,e/t,.1,1e3),this.renderer=new g.ub({antialias:!0,alpha:!0});var n=new g.r(12508653,14600926,.55);this.scene.add(n),(n=new g.lb(16777215,.75)).position.set(-80,100,100),n.castShadow=!0,this.scene.add(n),this.addModel(),this.camera.position.z=.5,this.camera.position.y=0,this.controls=new E.a(this.camera,this.renderer.domElement),this.controls.update(),this.renderer.setClearColor("#ffffff"),this.renderer.setSize(e,t),window.addEventListener("resize",this.onWindowResize,!1),this.mount.appendChild(this.renderer.domElement),this.start()}},{key:"componentDidUpdate",value:function(e){e.animationStatus!==this.props.animationStatus&&this.setState({animationStatus:this.props.animationStatus}),e.visemes!==this.props.visemes&&(this.visemes=this.props.visemes,this.visemesNames=Object(S.a)(new Set(this.props.visemes)),this.currentFrame=1,console.log(this.visemes),console.log(this.visemesNames)),e.sliderValue!==this.props.sliderValue&&this.setState({intensity:this.props.sliderValue})}},{key:"addCube",value:function(e,t,n){var a=new g.e(.1,.1,.1);a.translate(e,t,n);var i=new g.M({color:"#433F81"}),o=new g.L(a,i);this.scene.add(o)}},{key:"addModel",value:function(){var e=this;(new k.a).load("model/head_visemes.gltf",(function(t){e.model=O.a.clone(t.scene),console.log(e.model),e.scene.add(e.model),e.getModelControl(),e.renderScene()}),void 0,(function(e){console.error(e)}))}},{key:"onWindowResize",value:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}},{key:"componentWillUnmount",value:function(){this.mount.removeChild(this.renderer.domElement)}},{key:"start",value:function(){this.frameId||(this.frameId=requestAnimationFrame(this.animate))}},{key:"getModelControl",value:function(){var e=this;this.model&&this.model.traverse((function(t){t.isMesh&&"head"===t.name&&(e.modelControl=t.morphTargetInfluences,e.modelControlDict=t.morphTargetDictionary,e.modelControlActive=!0)}))}},{key:"calculateDistance",value:function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}},{key:"moveLid",value:function(){this.modelControl[this.modelControlDict.wink]<=0?(this.lidWait>100?(this.lidMove=this.lidSpeed,this.lidWait=0):this.lidMove=0,this.lidWait+=1):this.modelControl[this.modelControlDict.wink]>1&&(this.lidMove=-this.lidMove),this.modelControl[this.modelControlDict.wink]=this.modelControl[this.modelControlDict.wink]+this.lidMove}},{key:"nextViseme",value:function(){this.currentFrame<1&&(this.currentFrame=1);var e,t=this.visemes[this.currentFrame],n=this.visemes[this.currentFrame-1],a=Object(w.a)(this.visemesNames);try{for(a.s();!(e=a.n()).done;){var i=e.value;i===t?(this.modelControl[this.modelControlDict[i]]+=this.state.intensity/this.exponent,this.modelControl[this.modelControlDict[i]]>1&&(this.modelControl[this.modelControlDict[i]]=1)):(this.modelControl[this.modelControlDict[i]]-=this.state.intensity/(10-this.exponent),this.modelControl[this.modelControlDict[i]]<0&&(this.modelControl[this.modelControlDict[i]]=0))}}catch(o){a.e(o)}finally{a.f()}t===n?(this.exponent-=1,this.exponent<2&&(this.exponent=2)):this.exponent=8}},{key:"resetModel",value:function(){if(this.lidWait=0,this.modelControl)for(var e=0;e<this.modelControl.length;e++)this.modelControl[e]=0}},{key:"animate",value:function(){"PLAY"===this.state.animationStatus&&this.modelControlActive?(this.nextViseme(),this.moveLid(),this.currentFrame>=this.visemes.length&&(this.currentFrame=0),this.currentFrame+=1):"STOP"===this.state.animationStatus&&(this.currentFrame=1,this.resetModel()),this.controls.update(),this.renderScene(),this.frameId=window.requestAnimationFrame(this.animate)}},{key:"renderScene",value:function(){this.renderer.render(this.scene,this.camera)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{ref:function(t){e.mount=t}})}}]),n}(a.Component),C=n(29),P=n.n(C),F=n(48),M=(n(81),function(e){Object(b.a)(n,e);var t=Object(y.a)(n);function n(e){var a;return Object(p.a)(this,n),(a=t.call(this,e)).startRecording=function(){a.setState({record:!0})},a.stopRecording=function(){a.setState({record:!1})},a.onData=function(e){},a.onStop=function(e){console.log("recordedBlob is: ",e),a.props.newRecording(new File([e.blob],"recording.wav",{type:"audio/wav",lastModified:Date.now()}))},a.onSave=function(e){a.setState({downloadLinkURL:e.blobURL})},a.state={record:!1,downloadLinkURL:null},a}return Object(v.a)(n,[{key:"render",value:function(){return i.a.createElement("div",{id:"recorder-container"},i.a.createElement(F.ReactMic,{record:this.state.record,className:"sound-wave",onStop:this.onStop,onData:this.onData,onSave:this.onSave,strokeColor:"#000000",backgroundColor:"#FFFFFF",mimeType:"audio/wav",width:100,height:50,noiseSuppression:!0}),i.a.createElement("button",{className:"record-button record",onClick:this.startRecording,type:"button"},"Start"),i.a.createElement("button",{className:"record-button record",onClick:this.stopRecording,type:"button"},"Stop"),i.a.createElement("a",{className:"record",href:this.state.downloadLinkURL,download:"recording.wav"},"Download"))}}]),n}(i.a.Component)),A=(n(82),n(94)),D=n(49),R=Object(D.createAuthProvider)({accessTokenKey:"access_token",onUpdateToken:function(e){return fetch("/api/refresh",{method:"POST",body:e.access_token}).then((function(e){return e.json()}))}}),x=Object(r.a)(R,4),U=x[0],L=x[1],N=x[2],W=(x[3],{transition:"opacity ".concat(300,"ms ease-in-out"),opacity:0}),T={entering:{opacity:1},entered:{opacity:1},exiting:{opacity:0},exited:{opacity:0}},z=function(e){Object(b.a)(n,e);var t=Object(y.a)(n);function n(e){var a;return Object(p.a)(this,n),(a=t.call(this,e)).state={file:void 0,animationStatus:"STOP",visemes:void 0,inputProcessed:!1,sliderValue:.4,popup:!1,popupText:""},a.move=.02,a.delta=0,a.modelControlActive=!1,a.currentFrame=0,a.lidMove=.1,a.lidSpeed=.1,a.lidWait=1,a.play=a.play.bind(Object(f.a)(a)),a.pause=a.pause.bind(Object(f.a)(a)),a.stop=a.stop.bind(Object(f.a)(a)),a.processResponse=a.processResponse.bind(Object(f.a)(a)),a.fetchInput=a.fetchInput.bind(Object(f.a)(a)),a.playAnimation=a.playAnimation.bind(Object(f.a)(a)),a.pauseAnimation=a.pauseAnimation.bind(Object(f.a)(a)),a.stopAnimation=a.stopAnimation.bind(Object(f.a)(a)),a.handleFile=a.handleFile.bind(Object(f.a)(a)),a.sendFile=a.sendFile.bind(Object(f.a)(a)),a.handleSlider=a.handleSlider.bind(Object(f.a)(a)),a.handleRecording=a.handleRecording.bind(Object(f.a)(a)),a.openPopup=a.openPopup.bind(Object(f.a)(a)),a.closePopup=a.closePopup.bind(Object(f.a)(a)),a}return Object(v.a)(n,[{key:"componentDidMount",value:function(){this.fetchInput(),this.audio=new Audio,this.audio.loop=!0,this.setState({mounted:!0})}},{key:"componentDidUpdate",value:function(){}},{key:"fetchInput",value:function(){fetch("/api/time").then((function(e){return e.json()})).then((function(e){console.log(e)}))}},{key:"calculateDistance",value:function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}},{key:"processResponse",value:function(e){for(var t=[],n=void 0,a=void 0,i=0;i<e.length;i+=100/60)n=e.slice(i,i+100/60)[0],t.push(n),(a=t.length-1)>=3&&t[a-2]!==t[a-1]&&t[a-1]!==t[a]&&(t[t.length-2]=t[t.length-3]),a>=4&&t[a]!==t[a-1]&&(t[a-1]===t[a-2]&&t[a-2]===t[a-3]||(t[a-1]=t[a],t[a-2]=t[a-3]));this.setState({visemes:t,inputProcessed:!0})}},{key:"maxElement",value:function(e){if(0===e.length)return null;for(var t={},n=e[0],a=1,i=0;i<e.length;i++){var o=e[i];null==t[o]?t[o]=1:t[o]++,t[o]>a&&(n=o,a=t[o])}return n}},{key:"stop",value:function(){"PLAY"!==this.state.animationStatus&&"PAUSE"!==this.state.animationStatus||(this.audio.pause(),this.audio.currentTime=0,this.setState({animationStatus:"STOP"}))}},{key:"play",value:function(){"STOP"!==this.state.animationStatus&&"PAUSE"!==this.state.animationStatus||(this.audio.play(),this.setState({animationStatus:"PLAY"}))}},{key:"pause",value:function(){"PLAY"===this.state.animationStatus&&(this.audio.pause(),this.setState({animationStatus:"PAUSE"}))}},{key:"playAnimation",value:function(){this.state.inputProcessed?this.play():this.openPopup("Upload the audio file to the server!")}},{key:"stopAnimation",value:function(){this.state.inputProcessed?this.stop():this.openPopup("Upload the audio file to the server!")}},{key:"pauseAnimation",value:function(){this.state.inputProcessed?this.pause():this.openPopup("Upload the audio file to the server!")}},{key:"handleFile",value:function(e){if(console.log(e.target.files),e.target.files.length>0){var t=e.target.files[0],n=URL.createObjectURL(t);this.stop(),this.setState({file:t,inputProcessed:!1,filename:t.name}),this.audio.src=n}}},{key:"handleRecording",value:function(e){this.stop(),this.setState({file:e,inputProcessed:!1,filename:"Recording"}),this.audio.src=URL.createObjectURL(e),console.log(this.state.file,this.audio.src)}},{key:"sendFile",value:function(){var e=Object(m.a)(h.a.mark((function e(){var t,n=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.state.file?((t=new FormData).append("file",this.state.file),this.setState({inputProcessed:void 0}),this.stop(),L("/api/upload",{method:"POST",body:t}).then((function(e){return console.log(e),401===e.status?(n.setState({inputProcessed:!1}),n.openPopup("Sorry you aren't authorized!"),null):200!==e.status?(n.setState({inputProcessed:!1}),n.openPopup("Server failure!"),null):e.json()})).then((function(e){console.log(e),e&&(200===e.status?n.processResponse(e.result):"Extension"===e.message?(n.setState({inputProcessed:!1}),n.openPopup("Incorrect extension! Upload .wav and .mp3 files.")):"Model"===e.message&&(n.setState({inputProcessed:!1}),n.openPopup("Model failure!")))}))):this.openPopup("Choose a file!");case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleSlider",value:function(e){this.setState({sliderValue:e.target.value})}},{key:"openPopup",value:function(e){this.setState({popup:!0,popupText:e})}},{key:"closePopup",value:function(){this.setState({popup:!1,popupText:""})}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{id:"view-container"},i.a.createElement(A.a,{in:this.state.popup},(function(t){return i.a.createElement("div",{style:Object(d.a)(Object(d.a)({},W),T[t])},e.state.popup&&i.a.createElement("div",{className:"background"},i.a.createElement("div",{className:"popup"},i.a.createElement("div",{id:"popup-text"},e.state.popupText),i.a.createElement("button",{id:"popup-close",onClick:e.closePopup},"X"))))})),i.a.createElement(A.a,{in:void 0===this.state.inputProcessed},(function(t){return i.a.createElement("div",{style:Object(d.a)(Object(d.a)({},W),T[t])},void 0===e.state.inputProcessed&&i.a.createElement("div",{className:"background"},i.a.createElement("div",{className:"loader"})))})),i.a.createElement("div",{className:"top vertical"},i.a.createElement(M,{newRecording:this.handleRecording}),i.a.createElement("label",{className:"styled-button horizontal"},i.a.createElement("div",null,"Choose file"),i.a.createElement("div",{id:"chosen-file"},this.state.filename),i.a.createElement("input",{id:"choose-file",type:"file",accept:"audio/wav, audio/mp3",onChange:this.handleFile,multiple:!1})),i.a.createElement("button",{id:"upload-button",className:"styled-button narrow",onClick:this.sendFile},"Upload")),i.a.createElement(j,{id:"model",animationStatus:this.state.animationStatus,visemes:this.state.visemes,sliderValue:this.state.sliderValue}),i.a.createElement("div",{className:"bottom horizontal"},i.a.createElement("button",{id:"play",className:"player styled-button",onClick:this.playAnimation},"Play"),i.a.createElement("button",{id:"pause",className:"player styled-button",onClick:this.pauseAnimation},"Pause"),i.a.createElement("button",{id:"stop",className:"player styled-button",onClick:this.stopAnimation},"Stop"),i.a.createElement("span",{className:"spacer"}),i.a.createElement("div",{id:"slider-container",className:"player"},i.a.createElement("input",{type:"range",id:"slider",min:.1,max:1,value:this.state.sliderValue,step:.05,onChange:this.handleSlider}),i.a.createElement("div",null,this.state.sliderValue))))}}]),n}(a.Component),V=n(93),I=n(97),q=n(96),Y=n(95),_=function(e){Object(b.a)(n,e);var t=Object(y.a)(n);function n(e){var a;return Object(p.a)(this,n),(a=t.call(this,e)).state={username:"",password:"",status:"FALSE"},a.validateForm=a.validateForm.bind(Object(f.a)(a)),a.validateData=a.validateData.bind(Object(f.a)(a)),a.setUsername=a.setUsername.bind(Object(f.a)(a)),a.setPassword=a.setPassword.bind(Object(f.a)(a)),a}return Object(v.a)(n,[{key:"validateForm",value:function(){return this.state.username.length>0&&this.state.password.length>0}},{key:"handleSubmit",value:function(e){e.preventDefault()}},{key:"validateData",value:function(){var e=Object(m.a)(h.a.mark((function e(){var t,n,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=JSON.stringify({username:this.state.username,password:this.state.password}),e.next=3,P.a.post("/api/login",t,{});case 3:n=e.sent,(a=n.data).access_token?(N(a),console.log(a)):console.log("Please type in correct username/password");case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setUsername",value:function(e){this.setState({username:e.target.value})}},{key:"setPassword",value:function(e){this.setState({password:e.target.value})}},{key:"render",value:function(){return i.a.createElement("div",{className:"Login"},i.a.createElement("form",{onSubmit:this.handleSubmit},i.a.createElement(V.a,{id:"username",bssize:"large"},i.a.createElement(I.a,null,"Username"),i.a.createElement(q.a,{id:"username-form",autoFocus:!0,type:"text",value:this.state.username,onChange:this.setUsername})),i.a.createElement(V.a,{id:"password",bssize:"large"},i.a.createElement(I.a,null,"Password"),i.a.createElement(q.a,{id:"password-form",value:this.state.password,onChange:this.setPassword,type:"password"})),i.a.createElement(Y.a,{id:"login-button",block:!0,bssize:"large",disabled:!this.validateForm(),type:"submit",onClick:this.validateData},"Login")))}}]),n}(a.Component);var B=function(){var e=U(),t=Object(r.a)(e,1)[0];return console.log(t),i.a.createElement("div",{className:"App"},i.a.createElement(l.a,null,i.a.createElement(c.d,null,!t&&i.a.createElement(i.a.Fragment,null,i.a.createElement(c.b,{path:"/"},i.a.createElement(_,null)),i.a.createElement(c.a,{to:"/"})),t&&i.a.createElement(i.a.Fragment,null,i.a.createElement(c.b,{path:"/lipsync"},i.a.createElement(z,null)),i.a.createElement(c.a,{to:"/lipsync"})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(B,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[53,1,2]]]);
//# sourceMappingURL=main.711e4f66.chunk.js.map